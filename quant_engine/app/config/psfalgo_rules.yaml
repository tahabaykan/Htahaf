version: 2.0.0
general:
  cycle:
    interval_seconds: 240
    order_wait_seconds: 120
    auto_cancel_after_seconds: 120
    lot_divider_enabled: true
    controller_on_enabled: true
  intent:
    ttl_seconds: 90
    max_intents_per_cycle: 50
    auto_expire_enabled: true
  befday_tracking:
    enabled: true
    csv_file: befham.csv
    csv_file_ibkr_gun: befibgun.csv
    csv_file_ibkr_ped: befibped.csv
exposure:
  defensive_threshold_percent: 95.5
  offensive_threshold_percent: 92.7
  transition_mode: REDUCEMORE
  default_exposure_limit: 1200000
  default_avg_price: 100
  pot_expo_limit: 1400000
karbotu:
  gort_filter_longs:
    name: GORT Filter - Longs
    description: GORT > -1 ve Ask Sell Pahalılık > -0.05 olan pozisyonları filtrele
    enabled: true
    filters:
      gort_gt: -1
      ask_sell_pahalilik_gt: -0.05
    action: FILTER
    lot_calculation: GORT_SPECIAL
    order_type: ASK_SELL
  gort_filter_shorts:
    name: GORT Filter - Shorts
    description: GORT < 1 ve Bid Buy Ucuzluk < +0.05 olan pozisyonları filtrele
    enabled: true
    filters:
      gort_lt: 1
      bid_buy_ucuzluk_lt: 0.05
    action: FILTER
    lot_calculation: GORT_SPECIAL
    order_type: BID_BUY
  step_2:
    name: Fbtot < 1.10
    description: Fbtot < 1.10 ve Ask Sell Pahalılık > -0.10 → %50 sat
    enabled: true
    side: LONGS
    filters:
      fbtot_lt: 1.1
      ask_sell_pahalilik_gt: -0.1
      qty_ge: 100
    action: SELL
    lot_percentage: 50
    order_type: ASK_SELL
  step_3:
    name: Fbtot 1.11-1.45 Low
    description: Fbtot 1.11-1.45 ve Ask Sell Pahalılık -0.05 ile +0.04 arası → %25
      sat
    enabled: true
    side: LONGS
    filters:
      fbtot_gte: 1.11
      fbtot_lte: 1.45
      ask_sell_pahalilik_gte: -0.05
      ask_sell_pahalilik_lte: 0.04
      qty_ge: 100
    action: SELL
    lot_percentage: 25
    order_type: ASK_SELL
  step_4:
    name: Fbtot 1.11-1.45 High
    description: Fbtot 1.11-1.45 ve Ask Sell Pahalılık > +0.05 → %50 sat
    enabled: true
    side: LONGS
    filters:
      fbtot_gte: 1.11
      fbtot_lte: 1.45
      ask_sell_pahalilik_gt: 0.05
      qty_ge: 100
    action: SELL
    lot_percentage: 50
    order_type: ASK_SELL
  step_5:
    name: Fbtot 1.46-1.85 Low
    description: Fbtot 1.46-1.85 ve Ask Sell Pahalılık +0.05 ile +0.10 arası → %25
      sat
    enabled: true
    side: LONGS
    filters:
      fbtot_gte: 1.46
      fbtot_lte: 1.85
      ask_sell_pahalilik_gte: 0.05
      ask_sell_pahalilik_lte: 0.1
      qty_ge: 100
    action: SELL
    lot_percentage: 25
    order_type: ASK_SELL
  step_6:
    name: Fbtot 1.46-1.85 High
    description: Fbtot 1.46-1.85 ve Ask Sell Pahalılık > +0.10 → %50 sat
    enabled: true
    side: LONGS
    filters:
      fbtot_gte: 1.46
      fbtot_lte: 1.85
      ask_sell_pahalilik_gt: 0.1
      qty_ge: 100
    action: SELL
    lot_percentage: 50
    order_type: ASK_SELL
  step_7:
    name: Fbtot 1.86-2.10
    description: Fbtot 1.86-2.10 ve Ask Sell Pahalılık > +0.20 → %25 sat
    enabled: true
    side: LONGS
    filters:
      fbtot_gte: 1.86
      fbtot_lte: 2.1
      ask_sell_pahalilik_gt: 0.2
      qty_ge: 100
    action: SELL
    lot_percentage: 25
    order_type: ASK_SELL
  step_9:
    name: SFStot > 1.70
    description: SFStot > 1.70 ve Bid Buy Ucuzluk < +0.10 → %50 cover
    enabled: true
    side: SHORTS
    filters:
      sfstot_gt: 1.7
      bid_buy_ucuzluk_lt: 0.1
      qty_ge: 100
    action: COVER
    lot_percentage: 50
    order_type: BID_BUY
  step_10:
    name: SFStot 1.40-1.69 Low
    description: SFStot 1.40-1.69 ve Bid Buy Ucuzluk +0.05 ile -0.04 arası → %25 cover
    enabled: true
    side: SHORTS
    filters:
      sfstot_gte: 1.4
      sfstot_lte: 1.69
      bid_buy_ucuzluk_gte: -0.04
      bid_buy_ucuzluk_lte: 0.05
      qty_ge: 100
    action: COVER
    lot_percentage: 25
    order_type: BID_BUY
  step_11:
    name: SFStot 1.40-1.69 High
    description: SFStot 1.40-1.69 ve Bid Buy Ucuzluk < -0.05 → %50 cover
    enabled: true
    side: SHORTS
    filters:
      sfstot_gte: 1.4
      sfstot_lte: 1.69
      bid_buy_ucuzluk_lt: -0.05
      qty_ge: 100
    action: COVER
    lot_percentage: 50
    order_type: BID_BUY
  step_12:
    name: SFStot 1.10-1.39 Low
    description: SFStot 1.10-1.39 ve Bid Buy Ucuzluk +0.05 ile -0.04 arası → %25 cover
    enabled: true
    side: SHORTS
    filters:
      sfstot_gte: 1.1
      sfstot_lte: 1.39
      bid_buy_ucuzluk_gte: -0.04
      bid_buy_ucuzluk_lte: 0.05
      qty_ge: 100
    action: COVER
    lot_percentage: 25
    order_type: BID_BUY
  step_13:
    name: SFStot 1.10-1.39 High
    description: SFStot 1.10-1.39 ve Bid Buy Ucuzluk < -0.05 → %50 cover
    enabled: true
    side: SHORTS
    filters:
      sfstot_gte: 1.1
      sfstot_lte: 1.39
      bid_buy_ucuzluk_lt: -0.05
      qty_ge: 100
    action: COVER
    lot_percentage: 50
    order_type: BID_BUY
  settings:
    min_lot_size: 100
    cooldown_minutes: 5
    process_longs_first: true
    exclude_fbtot_zero: true
    exclude_sfstot_zero: true
reducemore:
  eligibility:
    exposure_ratio_threshold: 0.8
    pot_total_multiplier: 0.9
    modes:
    - DEFANSIF
    - GECIS
  gort_filter_longs:
    name: GORT Filter - Longs
    description: GORT > -1 ve Ask Sell Pahalılık > -0.05 olan pozisyonları filtrele
    enabled: true
    filters:
      gort_gt: -1
      ask_sell_pahalilik_gt: -0.05
    action: FILTER
    lot_calculation: GORT_SPECIAL
    order_type: ASK_SELL
  gort_filter_shorts:
    name: GORT Filter - Shorts
    description: GORT < 1 ve Bid Buy Ucuzluk < +0.05 olan pozisyonları filtrele
    enabled: true
    filters:
      gort_lt: 1
      bid_buy_ucuzluk_lt: 0.05
    action: FILTER
    lot_calculation: GORT_SPECIAL
    order_type: BID_BUY
  step_2:
    name: Fbtot < 1.10 (Aggressive)
    description: Fbtot < 1.10 ve Ask Sell Pahalılık > -0.10 → %75 sat
    enabled: true
    side: LONGS
    filters:
      fbtot_lt: 1.1
      ask_sell_pahalilik_gt: -0.1
      qty_ge: 100
    action: SELL
    lot_percentage: 75
    order_type: ASK_SELL
  step_3:
    name: Fbtot 1.11-1.45 Low (Aggressive)
    description: Fbtot 1.11-1.45 ve Ask Sell Pahalılık -0.05 ile +0.04 arası → %50
      sat
    enabled: true
    side: LONGS
    filters:
      fbtot_gte: 1.11
      fbtot_lte: 1.45
      ask_sell_pahalilik_gte: -0.05
      ask_sell_pahalilik_lte: 0.04
      qty_ge: 100
    action: SELL
    lot_percentage: 50
    order_type: ASK_SELL
  step_4:
    name: Fbtot 1.11-1.45 High (Aggressive)
    description: Fbtot 1.11-1.45 ve Ask Sell Pahalılık > +0.05 → %75 sat
    enabled: true
    side: LONGS
    filters:
      fbtot_gte: 1.11
      fbtot_lte: 1.45
      ask_sell_pahalilik_gt: 0.05
      qty_ge: 100
    action: SELL
    lot_percentage: 75
    order_type: ASK_SELL
  step_5:
    name: Fbtot 1.46-1.85 Low (Aggressive)
    description: Fbtot 1.46-1.85 ve Ask Sell Pahalılık +0.05 ile +0.10 arası → %50
      sat
    enabled: true
    side: LONGS
    filters:
      fbtot_gte: 1.46
      fbtot_lte: 1.85
      ask_sell_pahalilik_gte: 0.05
      ask_sell_pahalilik_lte: 0.1
      qty_ge: 100
    action: SELL
    lot_percentage: 50
    order_type: ASK_SELL
  step_6:
    name: Fbtot 1.46-1.85 High (Aggressive)
    description: Fbtot 1.46-1.85 ve Ask Sell Pahalılık > +0.10 → %75 sat
    enabled: true
    side: LONGS
    filters:
      fbtot_gte: 1.46
      fbtot_lte: 1.85
      ask_sell_pahalilik_gt: 0.1
      qty_ge: 100
    action: SELL
    lot_percentage: 75
    order_type: ASK_SELL
  step_7:
    name: Fbtot 1.86-2.10 (Aggressive)
    description: Fbtot 1.86-2.10 ve Ask Sell Pahalılık > +0.20 → %50 sat
    enabled: true
    side: LONGS
    filters:
      fbtot_gte: 1.86
      fbtot_lte: 2.1
      ask_sell_pahalilik_gt: 0.2
      qty_ge: 100
    action: SELL
    lot_percentage: 50
    order_type: ASK_SELL
  step_9:
    name: SFStot > 1.70 (Aggressive)
    description: SFStot > 1.70 ve Bid Buy Ucuzluk < +0.10 → %75 cover
    enabled: true
    side: SHORTS
    filters:
      sfstot_gt: 1.7
      bid_buy_ucuzluk_lt: 0.1
      qty_ge: 100
    action: COVER
    lot_percentage: 75
    order_type: BID_BUY
  step_10:
    name: SFStot 1.40-1.69 Low (Aggressive)
    description: SFStot 1.40-1.69 ve Bid Buy Ucuzluk +0.05 ile -0.04 arası → %50 cover
    enabled: true
    side: SHORTS
    filters:
      sfstot_gte: 1.4
      sfstot_lte: 1.69
      bid_buy_ucuzluk_gte: -0.04
      bid_buy_ucuzluk_lte: 0.05
      qty_ge: 100
    action: COVER
    lot_percentage: 50
    order_type: BID_BUY
  step_11:
    name: SFStot 1.40-1.69 High (Aggressive)
    description: SFStot 1.40-1.69 ve Bid Buy Ucuzluk < -0.05 → %75 cover
    enabled: true
    side: SHORTS
    filters:
      sfstot_gte: 1.4
      sfstot_lte: 1.69
      bid_buy_ucuzluk_lt: -0.05
      qty_ge: 100
    action: COVER
    lot_percentage: 75
    order_type: BID_BUY
  step_12:
    name: SFStot 1.10-1.39 Low (Aggressive)
    description: SFStot 1.10-1.39 ve Bid Buy Ucuzluk +0.05 ile -0.04 arası → %50 cover
    enabled: true
    side: SHORTS
    filters:
      sfstot_gte: 1.1
      sfstot_lte: 1.39
      bid_buy_ucuzluk_gte: -0.04
      bid_buy_ucuzluk_lte: 0.05
      qty_ge: 100
    action: COVER
    lot_percentage: 50
    order_type: BID_BUY
  step_13:
    name: SFStot 1.10-1.39 High (Aggressive)
    description: SFStot 1.10-1.39 ve Bid Buy Ucuzluk < -0.05 → %75 cover
    enabled: true
    side: SHORTS
    filters:
      sfstot_gte: 1.1
      sfstot_lte: 1.39
      bid_buy_ucuzluk_lt: -0.05
      qty_ge: 100
    action: COVER
    lot_percentage: 75
    order_type: BID_BUY
  settings:
    min_lot_size: 100
    cooldown_minutes: 5
    spread_tolerance_percent: 0.2
    process_longs_first: true
    exclude_fbtot_zero: true
    exclude_sfstot_zero: true
addnewpos:
  eligibility:
    exposure_ratio_threshold: 0.8
    exposure_mode: OFANSIF
  addlong:
    enabled: true
    filters:
      bid_buy_ucuzluk_lt: -0.06  # Negative = CHEAP (must be < -0.06)
      fbtot_gt: 1.10  # FBTOT > 1.10 = UCUZ (cheap) - Janall requirement
      spread_lt: 0.25
      avg_adv_gt: 500  # Minimum liquidity
    order_type: BID_BUY
  addshort:
    enabled: true
    filters:
      ask_sell_pahalilik_gt: 0.06  # Positive = PAHALI (expensive) - must be > 0.06
      sfstot_gt: 1.10  # SFStot > 1.10 = PAHALI (expensive) - Janall requirement for SHORT
      spread_lt: 0.25
      avg_adv_gt: 500  # Minimum liquidity
    order_type: ASK_SELL
  rules:
    thresholds:
    - max_portfolio_percent: 1
      maxalw_multiplier: 0.5
      portfolio_percent: 5
    - max_portfolio_percent: 3
      maxalw_multiplier: 0.4
      portfolio_percent: 4
    - max_portfolio_percent: 5
      maxalw_multiplier: 0.3
      portfolio_percent: 3
    - max_portfolio_percent: 7
      maxalw_multiplier: 0.2
      portfolio_percent: 2
    - max_portfolio_percent: 10
      maxalw_multiplier: 0.1
      portfolio_percent: 1.5
    - max_portfolio_percent: 100
      maxalw_multiplier: 0.05
      portfolio_percent: 1
    exposure_usage_percent: 60
  settings:
    max_lot_per_symbol: 200
    default_lot: 200
    min_lot_size: 100
    cooldown_minutes: 5
    min_avg_adv_divisor: 10
    mode: addlong_only
lot_divider:
  enabled: false
  max_lot_per_order: 500
  split_threshold: 500
  split_delay_ms: 500
controller_on:
  enabled: true
  order_cancel:
    enabled: true
    check_interval_seconds: 30
    max_order_age_seconds: 120
    cancel_unfilled_orders: true
  order_replace:
    enabled: true
    check_interval_seconds: 60
    price_improvement_threshold: 0.01
    replace_partial_fills: false
guardrails:
  maxalw:
    company_limit_enabled: true
    max_company_exposure_percent: 100
    check_before_order: true
  daily_limits:
    enabled: true
    max_daily_lot_change: 200000
    max_daily_lot_change_per_symbol: 15000
    max_daily_orders: 2500
    reset_time: 09:30:00
  order_limits:
    max_open_orders: 200
    max_open_orders_per_symbol: 15
    max_order_value: 100000
  duplicate_prevention:
    enabled: true
    duplicate_intent_window_seconds: 60
    same_symbol_cooldown_seconds: 300
    check_pending_orders: true
  position_limits:
    enabled: true
    max_position_per_symbol: 20000
    max_total_positions: 200
    max_sector_exposure_percent: 100
gort_lot_calculation:
  enabled: true
  method: PROPORTIONAL
  proportional:
    base_lot: 100
    gort_multiplier: 0.5
    max_lot: 500
  tiered:
  - gort_range:
    - -1
    - 0
    lot_percentage: 25
  - gort_range:
    - 0
    - 1
    lot_percentage: 50
  - gort_range:
    - 1
    - 2
    lot_percentage: 75
jfin:
  enabled: true
  tumcsv:
    selection_percent: 0.1
    min_selection: 2
    heldkuponlu_pair_count: 8
    # Janall selection criteria (two-step intersection)
    long_percent: 25.0  # Top %X for LONG (Janall: 25%)
    long_multiplier: 1.5  # Average × multiplier for LONG (Janall: 1.5x)
    short_percent: 25.0  # Bottom %X for SHORT (Janall: 25%)
    short_multiplier: 0.7  # Average × multiplier for SHORT (Janall: 0.7x)
    max_short: 3  # Maximum SHORT stocks per group (Janall: 3)
    # Company limit (Janall: limit_by_company)
    company_limit_enabled: true
    company_limit_divisor: 1.6  # Janall: max = total / 1.6
    presets:
      v10:
        selection_percent: 0.1
        min_selection: 2
        heldkuponlu_pair_count: 8
      v15:
        selection_percent: 0.12
        min_selection: 2
        heldkuponlu_pair_count: 10
      v20:
        selection_percent: 0.15
        min_selection: 3
        heldkuponlu_pair_count: 12
  lot_distribution:
    alpha: 3
    total_long_rights: 28000
    total_short_rights: 12000
    lot_rounding: 100
  percentage:
    default: 50
    options:
    - 25
    - 50
    - 75
    - 100
  exposure:
    exposure_percent: 60
    apply_to_all_pools: true
  lot_controls:
    min_lot_per_order: 200
    max_lot_per_order: 5000
  pools:
    separate_pools: true
    bb_long:
      enabled: true
      score_column: Final_BB_skor
      order_type: BID_BUY
      direction: LONG
    fb_long:
      enabled: false
      score_column: Final_FB_skor
      order_type: FRONT_BUY
      direction: LONG
    sas_short:
      enabled: false
      score_column: Final_SAS_skor
      order_type: ASK_SELL
      direction: SHORT
    sfs_short:
      enabled: false
      score_column: Final_SFS_skor
      order_type: FRONT_SELL
      direction: SHORT
  filters:
    bb_long:
      sma63_chg_lt: -1.6
      fbtot_gt: 0.8
      gort_lt: 1
    fb_long:
      sma63_chg_lt: -1.6
      fbtot_gt: 0.8
      gort_lt: 1
    sas_short:
      sma63_chg_gt: 1.6
      sfstot_gt: 0.8
      gort_gt: 1
    sfs_short:
      sma63_chg_gt: 1.6
      sfstot_gt: 0.8
      gort_gt: 1
  daily_limits:
    enabled: true
    befday_multiplier: 2
    fallback_multiplier: 2
  group_weights:
    csv_file: groupweights.csv
    default_long:
      HELDFF: 15
      DEZNFF: 10
      HELDKUPONLU: 20
      HELDNFF: 10
      HELDFLR: 5
      HIGHMATUR: 10
      NOTBESMATURLU: 5
      NOTCEFILLIQUID: 5
      SALAKILLIQUID: 5
      SHITREMHC: 5
    default_short:
      HELDFF: 10
      DEZNFF: 15
      HELDKUPONLU: 20
      HELDNFF: 10
      RUMOREDDANGER: 15
      SALAKILLIQUID: 10
      SHITREMHC: 10
  intent:
    status: PENDING
    ttl_seconds: 300
    require_approval: true
    auto_approve: false

# =============================================================================
# NEW SECTIONS - V2.1 Orchestrator & Risk Integration
# =============================================================================

# -----------------------------------------------------------------------------
# RISK REGIMES - Soft/Hard Derisk Thresholds (USER CONFIGURABLE)
# -----------------------------------------------------------------------------
risk_regimes:
  # Thresholds are EXPOSURE PERCENTAGES
  soft_derisk:
    threshold_pct: 120.0          # Soft de-risk starts at 120% exposure
    addnewpos_step_multiplier: 0.25  # ADDNEWPOS step drops to 25%
    engines_throttled: ["ADDNEWPOS"]
  
  hard_derisk:
    threshold_pct: 130.0          # Hard de-risk starts at 130% exposure
    cancel_risk_increasing: true  # Cancel all risk-increasing orders
    only_reduce_positions: true   # Only allow position reduction
    spread_penalty_active: true   # Spread matters for exit cost
  
  close:
    time_window_start: "15:00"    # Close mode starts at 3 PM
    time_window_end: "16:00"
    allow_addnewpos: false
    force_reduce_residual: true
  
  # Spread interpretation by mode
  spread_rules:
    # ADDNEWPOS: Spread = ADVANTAGE (pasif fill)
    addnewpos_spread_blocks: false
    addnewpos_spread_log_threshold: 0.30  # 30 cent üzeri logla
    # DERISK: Spread = COST (agresif exit)
    derisk_spread_penalty: true

# -----------------------------------------------------------------------------
# ORDER LIFECYCLE - TTL & Replace Policy
# -----------------------------------------------------------------------------
order_lifecycle:
  # TTL per intent category (seconds)
  ttl_by_category:
    LT_TRIM: 120        # 2 dakika
    MM_CHURN: 60        # 1 dakika
    ADDNEWPOS: 180      # 3 dakika
    KARBOTU: 120        # 2 dakika
    REDUCEMORE: 90      # 1.5 dakika
    HARD_DERISK: 30     # 30 saniye (acil)
    CLOSE_EXIT: 15      # 15 saniye (çok acil)
    DEFAULT: 90         # Fallback
  
  # Replace discipline
  min_replace_interval_seconds: 2.5  # Min 2.5s between replaces
  price_change_threshold_cents: 1    # Replace only if price changed >= 1 cent
  
  # Stale detection
  stale_data_threshold_seconds: 90   # Truth verisi >90s ise stale
  
  # Cancel policy
  selective_cancel_enabled: true     # NO mass cancel, only selective
  allow_emergency_cancel_all: false  # Manual emergency only

# -----------------------------------------------------------------------------
# ORCHESTRATOR - Phase Timing & Mode
# -----------------------------------------------------------------------------
orchestrator:
  enabled: true
  # MODE: OBSERVE_ONLY | SELECTIVE_ONLY | FULL
  mode: OBSERVE_ONLY
  phase_tick_seconds: 30
  
  # Phase schedule (Eastern Time)
  phases:
    PRE_MARKET:
      start: "04:00"
      end: "09:30"
      engines: []
      allow_addnewpos: false
    OPEN:
      start: "09:30"
      end: "10:00"
      engines: ["LT_TRIM", "MM_CHURN", "KARBOTU"]
      allow_addnewpos: false   # İlk 30dk ADDNEWPOS yok
    ACTIVE:
      start: "10:00"
      end: "14:00"
      engines: ["LT_TRIM", "MM_CHURN", "ADDNEWPOS", "KARBOTU", "REDUCEMORE"]
      allow_addnewpos: true
    MIDDAY:
      start: "14:00"
      end: "15:00"
      engines: ["LT_TRIM", "MM_CHURN", "KARBOTU"]
      allow_addnewpos: false   # Son 2 saat yavaşla
    CLOSE:
      start: "15:00"
      end: "16:00"
      engines: ["LT_TRIM", "HARD_EXIT"]
      allow_addnewpos: false

# -----------------------------------------------------------------------------
# LEGACY PSFALGO COMPATIBILITY
# -----------------------------------------------------------------------------
legacy_psfalgo:
  # When orchestrator.mode = FULL, set this to false
  legacy_runall_enabled: true
  legacy_autocycle_enabled: false  # DISABLED

# -----------------------------------------------------------------------------
# PRESETS (Hazır Ayar Setleri)
# -----------------------------------------------------------------------------
presets:
  conservative:
    description: "Düşük risk, küçük pozisyonlar"
    exposure.defensive_threshold_percent: 80
    exposure.offensive_threshold_percent: 75
    risk_regimes.soft_derisk.threshold_pct: 90
    risk_regimes.hard_derisk.threshold_pct: 100
    addnewpos.settings.max_lot_per_symbol: 100
  
  aggressive:
    description: "Yüksek risk, büyük pozisyonlar"
    exposure.defensive_threshold_percent: 100
    exposure.offensive_threshold_percent: 95
    risk_regimes.soft_derisk.threshold_pct: 130
    risk_regimes.hard_derisk.threshold_pct: 145
    addnewpos.settings.max_lot_per_symbol: 500
  
  default:

# =============================================================================
# MENTAL MODEL V1 - Intent & Lot Discipline (NEW)
# =============================================================================

# 1.1 Intent model (exposure -> Add/Reduce)
intent_model:
  type: piecewise_v1
  
  # User config: set HARD; SOFT auto derived with ratio 12/13
  hard_threshold_pct: 130.0
  soft_ratio_num: 12
  soft_ratio_den: 13
  
  # Shape params (defaults; user adjustable)
  Amax: 100.0  # Max Add Intent at 0% exposure
  Asoft: 20.0  # Add Intent at Soft Threshold
  pn: 1.25     # Normal zone curve
  q: 2.14      # Normal zone x transformation
  ps: 1.50     # Soft zone curve

# 1.2 Lot policy (global)
lot_policy:
  base_lot_default: 1000
  k_multiplier_default: 1.0
  
  # 100-lot trades never happen
  rounding:
    min_trade_lot: 200      # 100..199 -> 200
    no_trade_below_raw: 100 # raw < 100 -> 0
  
  # After-trade holding preference (plan-level)
  post_trade_hold_min: 200  # desired: holding is 0 or >=200

# 1.3 Strategy gating differences LT vs MM
gating:
  lt:
    goodness_min_normal: 70
    goodness_min_soft: 90
    goodness_min_hard: 999   # effectively blocked
    allow_soft_minlot_200: false   # soft: LT can skip small lots
  mm:
    goodness_min_normal: 60
    goodness_min_soft: 80
    goodness_min_hard: 999
    allow_soft_minlot_200: true    # soft: MM can still do 200-lot if opportunity

# 1.4 Pick count / selectivity (how many candidates per group)
pick_policy:
  add_intent_ge_70: 5
  add_intent_ge_40: 2
  add_intent_ge_20: 1
  add_intent_lt_20: 0
  # MM override: if add_intent < 20, still allow picks if mm_goodness >= 90
  mm_override_goodness: 90

# 1.5 Position direction policy (no flip)
position_direction:
  allow_flip_in_one_step: false   # never
  # MM churn allows reduce then re-add, but not exceed current position in a single trade
  mm_churn_allow_roundtrip: true


# =============================================================================
# JANALL DNA SECTIONS - Full Integration (V4.0)
# =============================================================================

# 4.1 Exit Logic (Time-Aware & Urgency)
exit_logic:
  urgency_multiplier: 1.8   # Compare MM vs LT loss (0.17 < 0.10 * 1.8)
  
  # Time Phases (Seconds Before Close)
  phases:
    phase_1:
      start_seconds: 120  # T-120
      end_seconds: 60     # T-60
      mode: MM_FRONT_ONLY # Attempt MM Front (FB/SFS), no passive
    phase_2:
      start_seconds: 60   # T-60
      end_seconds: 30     # T-30
      mode: LT_FRONT_OPT  # LT Front allowed if MM fail + urgency check
    phase_3:
      start_seconds: 30   # T-30
      end_seconds: 0      # Close
      mode: HARD_EXIT     # Active Hidden (AB/BS) - Aggressive

# 4.2 Pricing Recipes (Standardized)
pricing_recipes:
  # Entry / Passive
  PASSIVE_HIDDEN_BB:
    base: BID
    offset_type: SPREAD
    offset_value: 0.15    # + Spread * 0.15
  PASSIVE_HIDDEN_SAS:
    base: ASK
    offset_type: SPREAD
    offset_value: -0.15   # - Spread * 0.15

  # Front Run (MM & LT)
  FRONT_RUN_FB:
    base: LAST
    offset_type: FIXED
    offset_value: 0.01    # + 0.01
  FRONT_RUN_SFS:
    base: LAST
    offset_type: FIXED
    offset_value: -0.01   # - 0.01

  # Aggressive Exit Only (Active Hidden)
  ACTIVE_HIDDEN_AB:
    base: ASK
    offset_type: FIXED
    offset_value: 0.01    # + 0.01 (Cross spread)
  ACTIVE_HIDDEN_BS:
    base: BID
    offset_type: FIXED
    offset_value: -0.01   # - 0.01 (Cross spread)

# 4.3 Selection Logic (TumCSV)
selection:
  scoring:
    cheapness_multiplier: 1000  # Base - (1000 * cheapness)

  tumcsv_modes:
    v10:
      percent: 0.10
      min_count: 2
    v15:
      percent: 0.15
      min_count: 2
    v20:
      percent: 0.20
      min_count: 3
  
  issuer_limit:
    enabled: true
    divisor: 1.6  # Limit exposure to single issuer
    
# 4.4 Group DNA (Multipliers & Aggression)
group_dna:
  # Defaults if not specified per group
  default:
    multiplier: 1.0
    aggression: NORMAL
    max_cash_short: 0
  
  # Specific Groups (Examples)
  HELDKUPONLU:
    multiplier: 1.2
    max_cash_short: 200000
    aggression: HIGH
  HELDFF:
    multiplier: 1.0 
    aggression: NORMAL
